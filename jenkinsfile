pipeline {
    agent {
        docker {
            image 'maven:3.8.1-openjdk-17-slim'
            args '-u root -v /var/run/docker.sock:/var/run/docker.sock -v /usr/bin/docker:/usr/bin/docker'
        }
    }

    environment {
        PATH = "/usr/bin:$PATH"
        DOCKER_IMAGE = "vishwa275/javaimage"
        DOCKER_REGISTRY_CREDENTIALS = "dockerhub-credentials-id"
    }

    stages {
        stage('Debug Environment') {
            steps {
                script {
                    sh '''
                    echo "Testing Docker Environment..."
                    echo "PATH: $PATH"
                    id
                    groups || echo "Unable to retrieve groups"
                    which docker || echo "Docker binary not found"
                    docker --version || echo "Docker is not accessible"
                    '''
                }
            }
        }

        // Remaining stages...
    }

    post {
        always {
            echo 'Pipeline completed.'
        }
        success {
            echo 'Pipeline succeeded.'
        }
        failure {
            echo 'Pipeline failed.'
        }
    }
}
